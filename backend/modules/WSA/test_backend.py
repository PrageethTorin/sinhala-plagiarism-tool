import requests

# Port 8000 must match your main.py configuration
URL = "http://127.0.0.1:8000/api/check-wsa"

def run_research_test():
    # FIXED: Triple quotes handle multi-line Sinhala text without syntax errors
    test_text = (
"‡∂∏‡∑è‡∂±‡∑Ä ‡∑Ä‡∂Ç‡∑Å ‡∂¢‡∂±‡∂±‡∂∫ (‡∂ú‡∑ä‚Äç‡∂ª‡∑ì‡∂ö‡∑ä ‡∂ë‡∂≠‡∑ä‡∂±‡∑ú‡∑É‡∑ä ·ºîŒ∏ŒΩŒøœÇ, ‡∂∏‡∑è‡∂±‡∑Ä‡∂∫‡∂±‡∑ä ‡∂ö‡∂´‡∑ä‡∂©‡∑è‡∂∫‡∂∏ ‡∑Ñ‡∑ù ‡∂¢‡∑è‡∂≠‡∑í‡∂∫, ‡∑É‡∑Ñ ‡∂¢‡∑ô‡∂±‡∑É‡∑í‡∑É‡∑ä Œ≥Œ≠ŒΩŒµœÉŒπœÇ, ‡∂á‡∂ª‡∂π‡∑î‡∂∏, ‡∂ã‡∂¥‡∂≠, ‡∂∂‡∑Ñ‡∑î. ‡∂ë‡∂≠‡∑ä‡∂±‡∑ú‡∂¢‡∑ô‡∂±‡∑É‡∑í‡∑É‡∑ä ‡∑Ä‡∑ô‡∂≠‡∑í‡∂±‡∑ä) ‡∑Ä‡∂±‡∑è‡∑Ñ‡∑í, ‡∂ö‡∑í‡∑É‡∑í‡∂∫‡∂∏‡∑ä ‡∂¥‡∑î‡∑Ö‡∑î‡∂Ω‡∑ä ‡∑É‡∂∏‡∑è‡∂¢ ‡∂¥‡∑É‡∑î‡∂≠‡∂Ω‡∂∫‡∂ö‡∑ä ‡∂≠‡∑î‡∂Ω‡∑í‡∂±‡∑ä ‡∂¥‡∑ê‡∂±‡∂±‡∑ê‡∂ú‡∑î‡∂±‡∑î ‡∂∫‡∂∏‡∑ä ‡∂∏‡∑è‡∂±‡∑Ä‡∂∫‡∂±‡∑ä ‡∂ö‡∂´‡∑ä‡∂©‡∑è‡∂∫‡∂∏‡∂ö‡∑ä ‡∂≠‡∂∏‡∂±‡∑ä ‡∂¢‡∂±‡∑Ä‡∑è‡∂ª‡∑ä‡∂ú‡∑í‡∂ö ‡∂Ö‡∂∫‡∑î‡∂ª‡∑í‡∂±‡∑ä ‡∑Ä‡∑ô‡∂±‡∑É‡∑ä ‡∂∂‡∑Ä‡∂ß ‡∂≠‡∑ö‡∂ª‡∑î‡∂∏‡∑ä ‡∂ú‡∑ô‡∂± ‡∑Ñ‡∑ù ‡∂≠‡∑ö‡∂ª‡∑î‡∂∏‡∑ä ‡∂ú‡∂±‡∑í‡∂∏‡∑í‡∂±‡∑ä ‡∑Ñ‡∑ù ‡∑É‡∑í‡∂ß‡∑í‡∂± ‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è‡∑Ä‡∂Ω‡∑í‡∂∫‡∂∫‡∑í. ‡∂ä. ‡∂¥‡∑ì. ‡∂≠‡∑ú‡∂∏‡∑ä‡∂¥‡∑ä‡∑É‡∂±‡∑ä ‡∂ú‡∑ö ‡∑Ä‡∂Ø‡∂±‡∑ä ‡∂Ö‡∂±‡∑î‡∑Ä, ‡∂∏‡∑ô‡∂∏ ‡∑É‡∑ä‡∑Ä‡∂∫‡∂Ç-‡∂¥‡∂ª‡∑í‡∂ö‡∂Ω‡∑ä‡∂¥‡∂±‡∂∫ ‡∂≠‡∑î‡∂Ω‡∑í‡∂±‡∑ä ‡∂¢‡∂±‡∑Ä‡∑è‡∂ª‡∑ä‡∂ú‡∑ì‡∂ö ‡∂ö‡∂´‡∑ä‡∂©‡∑è‡∂∫‡∂∏‡∑ä ‡∂î‡∑Ä‡∑î‡∂±‡∑ä ‡∑Ä‡∑í‡∑É‡∑í‡∂±‡∑ä‡∂∏ ‡∂¢‡∂±‡∂±‡∂∫ ‡∂ö‡∂ª‡∂ú‡∑ê‡∂±‡∑î‡∂∏‡∑ô‡∂±‡∑ä ‡∂ö‡∂ª‡∂Ω‡∑í‡∂∫‡∂ß ‡∂ë‡∂≠‡∑í. ‡∂∏‡∑ô‡∂∏ ‡∑É‡∂Ç‡∑É‡∑ä‡∂ö‡∑ò‡∂≠‡∑í‡∂ö ‡∂¢‡∂±‡∂±‡∂∫ ‡∂¥‡∑í‡∑Ö‡∑í‡∂ú‡∑ê‡∂±‡∑ä‡∂∏‡∂ß ‡∂Ω‡∂ö‡∑ä‡∑Ä‡∑ì‡∂∏ ‡∑Ñ‡∑ö‡∂≠‡∑î‡∑Ä‡∑ô‡∂±‡∑ä, ‡∑Ä‡∂ª‡∑ô‡∂ö ‡∂Ö‡∑Ä‡∑í‡∂†‡∑è‡∂ª‡∑Ä‡∂≠‡∑ä ‡∂Ω‡∑ô‡∑É‡∑í‡∂±‡∑ä ‡∂ì‡∂≠‡∑í‡∑Ñ‡∑è‡∑É‡∑í‡∂ö ‡∑É‡∑í‡∂Ø‡∑ä‡∂∞‡∑è‡∂±‡∑ä‡∂≠ ‡∂Ω‡∑ô‡∑É‡∑í‡∂±‡∑ä ‡∂¥‡∑í‡∑Ö‡∑í‡∂ú‡∑ê‡∂±‡∑î‡∂±‡∑î ‡∑É‡∑è‡∂∏‡∑ä‡∂¥‡∑ä‚Äç‡∂ª‡∂Ø‡∑è‡∂∫‡∑í‡∂ö ‡∑É‡∑è‡∂∞‡∑ä‚Äç‡∂∫‡∂≠‡∑è‡∂∏‡∂∫ ‡∂¢‡∑è‡∂≠‡∑ì‡∂±‡∑ä-‡∂¢‡∂±‡∂±‡∂∫‡∑ö ‡∑Ä‡∑ò‡∂≠‡∑ä‡∂≠‡∑è‡∂±‡∑ä‡∂≠‡∂∫‡∂±‡∑ä ‡∂¢‡∂±‡∂¥‡∑ä‚Äç‡∂ª‡∑Ä‡∑è‡∂Ø ‡∂¥‡∂ª‡∑í‡∂ú‡∂≠‡∂∫‡∂ß ‡∂Ö‡∂±‡∑î‡∂∫‡∑î‡∂ö‡∑ä‡∂≠ ‡∂ö‡∑ô‡∂ª‡∑î‡∂∏‡∂ß ‡∑É‡∂∏‡∑Ñ‡∂ª‡∂ö‡∑ä ‡∂â‡∂≠‡∑í‡∑Ñ‡∑è‡∑É‡∂•‡∂∫‡∑í‡∂±‡∑ä ‡∂¥‡∑ô‡∑Ö‡∂π‡∑ì ‡∂á‡∂≠"
    )
    try:
        response = requests.post(URL, json={"text": test_text.strip()}, timeout=60)
        
        if response.status_code == 200:
            data = response.json()
            print("="*80)
            print("‚úÖ DYNAMIC RESEARCH ANALYSIS (STYLE & INTERNET DISCOVERY)")
            print(f"üìä Style Change Ratio: {data.get('style_change_ratio', 0)}%")
            print(f"üîó BEST SAME IDEA URL: {data.get('matched_url', 'No source found')}")
            print("-" * 80)
            print(f"{'ID':<4} | {'Len':<5} | {'TTR %':<10} | {'Status'}")
            print("-" * 60)
            
            for s in data.get('sentence_map', []):
                # Status logic based on outlier calculation in wsa_engine
                status = "üö© STYLE SHIFT" if s['is_outlier'] else "‚úì Baseline"
                print(f"S{s['id']:<3} | {s['length']:<5} | {s['lexical_ttr']:<10} | {status}")
            print("-" * 80)
        else:
            print(f"‚ùå Server Error: {response.status_code} - Check main.py logs")
            
    except Exception as e:
        print(f"‚ùå Connection Error: Ensure main.py is running on port 8000")

if __name__ == "__main__":
    run_research_test()